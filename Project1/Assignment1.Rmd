---
title: "DATA621 | Project I"
author: "Abdellah AitElmouden | Gabriel Abreu |  Jered Ataky | Patrick Maloney"
date: "2/12/2021"
output:
  pdf_document: default
  
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(corrplot)
library(tidyverse)
library(Hmisc)
library(PerformanceAnalytics)
library(corrplot)
```


## Abstract

To see how regression will help us evaluate baseball team performance, we will explore, analyze and model a historical baseball data set containing approximately 2200 records, to determine a teamâ€™s performance based on statistics of their performance. Each record represents a professional baseball team from the years 1871 to 2006 inclusive, and the data include the performance of the team for the given year, with all of the statistics adjusted to match the performance of a 162 game season.

While correlation does not equal causation it is suggested that a focus on some of the variables such as a focus on either single hits or triple or more hits to the exclusion of doubles might be worth pursuing. Also the data suggests that a focus on home runs allowed may not be worth giving up a number of more normal hits.

.....To add more here....

## Introduction

Because baseball is so numbers-heavy, there are many different statistics to consider when searching for the best predictors of team success. There are offensive statistics (offense meaning when a team is batting) and defensive statistics (defense meaning when a team is in the field). These categories can be broken up into many more subcategories. However, for the purpose of the this project we will use the available data to build a multiple linear regression model on the training data to predict the number of wins for  the  team.

## Data Used

the data was provided in csv file. The files contain approximately 2200 records. Each record represents a professional baseball team from the years 1871 to 2006 inclusive. Each record has the performance of the team for the given year, with all of the statistics adjusted to match the performance of a 162 game season.

| VARIABLE NAME    | DEFINITION                             | THEORETICAL EFFECT      |
|------------------|----------------------------------------|-------------------------|
| INDEX            | Identification Variable (do not use)   | None                    |
| TARGET_WINS      | Number of wins                         | Outcome Variable        |
| TEAM_BATTING_H   | Base Hits by batters (1B,2B,3B,HR)     | Positive Impact on Wins |
| TEAM_BATTING_2B  | Doubles by batters (2B)                | Positive Impact on Wins |
| TEAM_BATTING_3B  | Triples by batters (3B)                | Positive Impact on Wins |
| TEAM_BATTING_HR  | Homeruns by batters (4B)               | Positive Impact on Wins |
| TEAM_BATTING_BB  | Walks by batters                       | Positive Impact on Wins |
| TEAM_BATTING_HBP | Batters hit by pitch (get a free base) | Positive Impact on Wins |
| TEAM_BATTING_SO  | Strikeouts by batters                  | Negative Impact on Wins |
| TEAM_BASERUN_SB  | Stolen bases                           | Positive Impact on Wins |
| TEAM_BASERUN_CS  | Caught stealing                        | Negative Impact on Wins |
| TEAM_FIELDING_E  | Errors                                 | Negative Impact on Wins |
| TEAM_FIELDING_DP | Double Plays                           | Positive Impact on Wins |
| TEAM_PITCHING_BB | Walks allowed                          | Negative Impact on Wins |
| TEAM_PITCHING_H  | Hits allowed                           | Negative Impact on Wins |
| TEAM_PITCHING_HR | Homeruns allowed                       | Negative Impact on Wins |
| TEAM_PITCHING_SO | Strikeouts by pitchers                 | Positive Impact on Wins |

## Data exploration 

The initial steps are to download the data and take a quick glimpse of the columns, their data types, number of columns, and rows. 
```{r}
#Import data 

data <- read.csv("https://raw.githubusercontent.com/aaitelmouden/DATA621/master/Project1/moneyball-training-data.csv")
glimpse(data)

```
At first glance, the column BATTING_HBP has numerous NA values that will need to be addressed before building a model. It's worth exploring for other columns with NA values.
```{r}
summary(data)
```
```{r}
max_obs <- 2276
batting_so_na <- ((102/max_obs) * 100)
baserun_sb_na <- (131/max_obs) * 100
baserun_cs_na <- (772/max_obs) * 100
batting_hbp_na <- (2085/max_obs) * 100
pitching_so_na <- (102/max_obs) * 100
fielding_dp_na <- (286/max_obs) * 100

df_percent_na <- data.frame(Columns_w_NA = c("team_batting_so", "team_baserun_sb", "team_baserun_cs", "team_batting_hbp", "team_pitching_so", "team_fielding_dp"), Percent_NA = c(batting_so_na, baserun_sb_na, baserun_cs_na, batting_hbp_na, pitching_so_na, fielding_dp_na))

as_tibble(df_percent_na)
```

```{r}


data[-c(1)] %>%
  gather() %>% 
  ggplot(aes(value)) +
    facet_wrap(~ key, scales = "free") +
    geom_histogram(binwidth=1)

```
```{r}

#pairwise.complete.obs ignores NA values and computes correlation on complete observations
#we might have to run these corrplots again after we handle the NA values
chart.Correlation(data[-c(1)], histograme=TRUE, method= "pearson", use="pairwise.complete.obs")
```


```{r}
data.corr <- cor(data[-c(1)], use="pairwise.complete.obs")

corrplot(data.corr, type = "lower", method="square")
```

### Variable Selection
```{r, include = FALSE}
flattenCorrMatrix <- function(cormat, pmat) {
  ut <- upper.tri(cormat)
  data.frame(
    row = rownames(cormat)[row(cormat)[ut]],
    column = rownames(cormat)[col(cormat)[ut]],
    cor  =(cormat)[ut],
    p = pmat[ut]
    )
}
```

```{r}
#eliminate INDEX from data frame
data_no_index <- data[-c(1)]

cor_matrix <- rcorr(as.matrix(data_no_index))

flattenCorrMatrix(cor_matrix$r, cor_matrix$P)
```
### Outliers

### Correlations among predictors

## Data Preparation

## Build Models

## Select Model

## Appendix 

## References